{"version":3,"sources":["traceur-instrumenter.js","@traceur/generated/TemplateParser/7","@traceur/generated/TemplateParser/5","@traceur/generated/TemplateParser/2","@traceur/generated/TemplateParser/3","@traceur/generated/TemplateParser/6","@traceur/generated/TemplateParser/0","@traceur/generated/TemplateParser/24","@traceur/generated/TemplateParser/26","@traceur/generated/TemplateParser/25","@traceur/generated/TemplateParser/23","@traceur/generated/TemplateParser/22","@traceur/generated/TemplateParser/1"],"names":[],"mappings":"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","file":"traceur-instrumenter.js.map","sourceRoot":"/source/","sourcesContent":["import istanbul from 'istanbul';\nimport esprima from 'esprima-fb';\nimport sourceMap from 'source-map';\nimport traceur from 'traceur';\nimport path from 'path';\nimport fs from 'fs';\n\nconst DEFAULT_TRACEUR_OPTIONS = {\n  modules: 'commonjs',\n  sourceMaps: 'file'\n};\n\nfunction createSourceMapConsumer(map) {\n  if (typeof map === 'string') {\n    map = JSON.parse(map);\n  }\n  return new sourceMap.SourceMapConsumer(map);\n}\n\n\n/**\n *  Istanbul instrumenter extention that compiles es6 source into es5 version\n *\n *  @class TraceurInstrumenter\n *  @extends instanbul.Instrumenter\n */\nclass TraceurInstrumenter extends istanbul.Instrumenter {\n  /**\n   *  @constructor\n   *  @param {object} opts - options passed to istanbul.Instrumenter\n   */\n  constructor(opts = {}) {\n    istanbul.Instrumenter.call(this, opts);\n    this._createTraceurCompiler(opts.traceurOpts);\n  }\n\n  /**\n   *  Internal function used to set default values to _traceurOpts\n   *\n   *  @function\n   *  @param {object} opts - traceurOpts passed from constructor\n   */\n  _createTraceurCompiler(opts = {}) {\n    for (var key in DEFAULT_TRACEUR_OPTIONS) {\n      if (!opts.hasOwnProperty(key)) {\n        opts[key] = DEFAULT_TRACEUR_OPTIONS[key];\n      }\n    }\n    this._compiler = new traceur.NodeCompiler(opts);\n  }\n\n\n  _compile(code, filename) {\n    var compiled = this._compiler.compile(code, filename);\n\n    return {\n      code: compiled,\n      map: this._compiler.getSourceMap()\n    };\n  }\n\n  _parse(code) {\n\n    var program = esprima.parse(code, {\n      loc: true,\n      range: true,\n      sourceType: 'module'\n    });\n    return program;\n  }\n\n  instrumentSync(code, filename) {\n\n      var compiled = this._compile(code, filename);\n      var program = this._parse(compiled.code);\n\n\n      this._sourceMap = createSourceMapConsumer(compiled.map);\n\n      return this.instrumentASTSync(program, filename, code);\n  }\n\n    /**\n     * Fix the location using the source maps used to compile and generate the\n     *  code.\n     * @param {Object} location The location to fix.\n     */\n  _fixLocation(location) {\n    location.start = this._sourceMap.originalPositionFor(\n      location.start);\n      location.end = this._sourceMap.originalPositionFor(location.end);\n      if(location.start.source !== this.coverState.path) {\n        location.start = {line: 0, column: 0};\n        location.end = { line: 0, column: 0};\n        location.skip = true;\n      }\n  }\n\n\n  getPreamble(sourceCode, emitUseStrict) {\n    if (this._sourceMap) {\n      var statementMap = this.coverState.statementMap,\n        functionMap = this.coverState.fnMap,\n        branchMap = this.coverState.branchMap,\n        key = null,\n        map = null;\n\n      for (key in statementMap) {\n        if (statementMap.hasOwnProperty(key)) {\n          map = statementMap[key];\n          this._fixLocation(map);\n        }\n      }\n\n      for (key in functionMap) {\n        if (functionMap.hasOwnProperty(key)) {\n          map = functionMap[key];\n          this._fixLocation(map.loc);\n        }\n      }\n\n      for (key in branchMap) {\n        if (branchMap.hasOwnProperty(key)) {\n          var locations = branchMap[key].locations;\n\n          for (var i = 0; i < locations.length; i++) {\n            this._fixLocation(locations[i]);\n          }\n        }\n      }\n    }\n\n    return super.getPreamble(sourceCode, emitUseStrict);\n  }\n\n}\n\nexport\ndefault TraceurInstrumenter;\n","Object.defineProperties(exports, $__placeholder__0);","{get: $__placeholder__0}","get $__placeholder__0() { return $__placeholder__1; }","__esModule: true","{value: $__placeholder__0}","($__placeholder__0 = require($__placeholder__1),\n        $__placeholder__2 && $__placeholder__3.__esModule && $__placeholder__4 || {default: $__placeholder__5})","var $__placeholder__0 = $__placeholder__1","var $__placeholder__0 = $__placeholder__1","($traceurRuntime.createClass)($__placeholder__0, $__placeholder__1, $__placeholder__2,\n                                       $__placeholder__3)","$__placeholder__0.call($__placeholder__1)","$traceurRuntime.superGet($__placeholder__0, $__placeholder__1, $__placeholder__2)","var $__default = $__placeholder__0"]}