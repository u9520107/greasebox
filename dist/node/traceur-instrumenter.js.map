{"version":3,"sources":["traceur-instrumenter.js","@traceur/generated/TemplateParser/7","@traceur/generated/TemplateParser/5","@traceur/generated/TemplateParser/2","@traceur/generated/TemplateParser/3","@traceur/generated/TemplateParser/6","@traceur/generated/TemplateParser/0","@traceur/generated/TemplateParser/10","@traceur/generated/TemplateParser/12","@traceur/generated/TemplateParser/11","@traceur/generated/TemplateParser/9","@traceur/generated/TemplateParser/8","@traceur/generated/TemplateParser/1"],"names":[],"mappings":"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","file":"traceur-instrumenter.js.map","sourceRoot":"/source\\node/","sourcesContent":["import istanbul from 'istanbul';\r\nimport esprima from 'esprima';\r\nimport sourceMap from 'source-map';\r\nimport escodegen from 'escodegen';\r\nimport traceur from 'traceur';\r\nimport path from 'path';\r\nimport fs from 'fs';\r\n\r\nconst DEFAULT_TRACEUR_OPTIONS = {\r\n  modules: 'commonjs',\r\n  sourceMaps: 'file'\r\n};\r\n\r\nfunction createSourceMapConsumer(map) {\r\n  if (typeof map === 'string') {\r\n    map = JSON.parse(map);\r\n  }\r\n  return new sourceMap.SourceMapConsumer(map);\r\n}\r\n\r\n\r\n/**\r\n *  Istanbul instrumenter extention that compiles es6 source into es5 version\r\n *\r\n *  @class TraceurInstrumenter\r\n *  @extends instanbul.Instrumenter\r\n */\r\nclass TraceurInstrumenter extends istanbul.Instrumenter {\r\n  /**\r\n   *  @constructor\r\n   *  @param {object} opts - options passed to istanbul.Instrumenter\r\n   */\r\n  constructor(opts = {}) {\r\n    istanbul.Instrumenter.call(this, opts);\r\n    this._createTraceurCompiler(opts.traceurOpts);\r\n  }\r\n\r\n  /**\r\n   *  Internal function used to set default values to _traceurOpts\r\n   *\r\n   *  @function\r\n   *  @param {object} opts - traceurOpts passed from constructor\r\n   */\r\n  _createTraceurCompiler(opts = {}) {\r\n    for (var key in DEFAULT_TRACEUR_OPTIONS) {\r\n      if (!opts.hasOwnProperty(key)) {\r\n        opts[key] = DEFAULT_TRACEUR_OPTIONS[key];\r\n      }\r\n    }\r\n    this._compiler = new traceur.NodeCompiler(opts);\r\n  }\r\n\r\n\r\n  _compile(code, filename) {\r\n    var compiled = this._compiler.compile(code, filename);\r\n\r\n    return {\r\n      code: compiled,\r\n      map: this._compiler.getSourceMap()\r\n    };\r\n  }\r\n\r\n  _parse(code) {\r\n\r\n    var program = esprima.parse(code, {\r\n      loc: true,\r\n      range: true\r\n    });\r\n    return program;\r\n  }\r\n\r\n  instrumentSync(code, filename) {\r\n\r\n      var compiled = this._compile(code, filename);\r\n      var program = this._parse(compiled.code);\r\n\r\n\r\n      this._sourceMap = createSourceMapConsumer(compiled.map);\r\n\r\n      return this.instrumentASTSync(program, filename, code);\r\n  }\r\n\r\n    /**\r\n     * Fix the location using the source maps used to compile and generate the\r\n     *  code.\r\n     * @param {Object} location The location to fix.\r\n     */\r\n  _fixLocation(location) {\r\n    location.start = this._sourceMap.originalPositionFor(\r\n      location.start);\r\n      location.end = this._sourceMap.originalPositionFor(location.end);\r\n      if(location.start.source !== this.coverState.path) {\r\n        location.start = {line: 0, column: 0};\r\n        location.end = { line: 0, column: 0};\r\n        location.skip = true;\r\n      }\r\n  }\r\n\r\n\r\n  getPreamble(sourceCode, emitUseStrict) {\r\n    if (this._sourceMap) {\r\n      var statementMap = this.coverState.statementMap,\r\n        functionMap = this.coverState.fnMap,\r\n        branchMap = this.coverState.branchMap,\r\n        key = null,\r\n        map = null;\r\n\r\n      for (key in statementMap) {\r\n        if (statementMap.hasOwnProperty(key)) {\r\n          map = statementMap[key];\r\n          this._fixLocation(map);\r\n        }\r\n      }\r\n\r\n      for (key in functionMap) {\r\n        if (functionMap.hasOwnProperty(key)) {\r\n          map = functionMap[key];\r\n          this._fixLocation(map.loc);\r\n        }\r\n      }\r\n\r\n      for (key in branchMap) {\r\n        if (branchMap.hasOwnProperty(key)) {\r\n          var locations = branchMap[key].locations;\r\n\r\n          for (var i = 0; i < locations.length; i++) {\r\n            this._fixLocation(locations[i]);\r\n          }\r\n        }\r\n      }\r\n    }\r\n\r\n    return super.getPreamble(sourceCode, emitUseStrict);\r\n  }\r\n\r\n}\r\n\r\nexport\r\ndefault TraceurInstrumenter;\r\n","Object.defineProperties(exports, $__placeholder__0);","{get: $__placeholder__0}","get $__placeholder__0() { return $__placeholder__1; }","__esModule: true","{value: $__placeholder__0}","($__placeholder__0 = require($__placeholder__1),\n        $__placeholder__2 && $__placeholder__3.__esModule && $__placeholder__4 || {default: $__placeholder__5})","var $__placeholder__0 = $__placeholder__1","var $__placeholder__0 = $__placeholder__1","($traceurRuntime.createClass)($__placeholder__0, $__placeholder__1, $__placeholder__2,\n                                       $__placeholder__3)","$__placeholder__0.call($__placeholder__1)","$traceurRuntime.superGet($__placeholder__0, $__placeholder__1, $__placeholder__2)","var $__default = $__placeholder__0"]}